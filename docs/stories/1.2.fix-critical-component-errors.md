# Story 1.2: Fix Critical Component Import and Field Reference Errors

## Status
Draft

## Story
**As a** user,
**I want** the walk discovery and detail pages to load without JavaScript errors,
**so that** I can browse walks and view detailed information successfully.

## Acceptance Criteria
1. Replace `RegionMap` import with `ScotlandRegionMap` in WalkDiscovery.tsx
2. Update all UI references from `walk.rating` to `walk.averageRating` throughout codebase
3. Connect WalkDetailPage to real Convex queries instead of mock data
4. Verify all component imports resolve correctly
5. Test all affected pages render without console errors

## Tasks / Subtasks
- [ ] Task 1: Fix RegionMap import error in WalkDiscovery component (AC: 1, 4)
  - [ ] Subtask 1.1: Locate WalkDiscovery.tsx at app/walks/WalkDiscovery.tsx line 13
  - [ ] Subtask 1.2: Replace `import { RegionMap }` with `import { ScotlandRegionMap }`
  - [ ] Subtask 1.3: Update component usage from `<RegionMap>` to `<ScotlandRegionMap>`
  - [ ] Subtask 1.4: Verify import resolves to components/map/ScotlandRegionMap.tsx
- [ ] Task 2: Update field references from rating to averageRating (AC: 2, 5)
  - [ ] Subtask 2.1: Search codebase for all instances of `walk.rating` references
  - [ ] Subtask 2.2: Replace with `walk.averageRating` in all UI components
  - [ ] Subtask 2.3: Update TypeScript interfaces to match schema field names
  - [ ] Subtask 2.4: Verify no compilation errors after field name changes
- [ ] Task 3: Connect WalkDetailPage to real Convex queries (AC: 3, 5)
  - [ ] Subtask 3.1: Remove mock data imports from WalkDetailPage.tsx
  - [ ] Subtask 3.2: Add proper useQuery hooks for walk data retrieval
  - [ ] Subtask 3.3: Update component to handle loading and error states
  - [ ] Subtask 3.4: Test real-time data updates work correctly
- [ ] Task 4: Comprehensive testing and validation (AC: 4, 5)
  - [ ] Subtask 4.1: Test WalkDiscovery page loads without console errors
  - [ ] Subtask 4.2: Test WalkDetailPage displays real walk information
  - [ ] Subtask 4.3: Verify map components display properly with existing geographic data
  - [ ] Subtask 4.4: Confirm all imports resolve correctly in development build

## Dev Notes

### Previous Story Insights
**Story 1.1 Context:** After implementing missing Convex backend functions (`walkStages.getStagesByWalkId`, `walkReports.getReportsByWalk`), UI components can now connect to real database functions. This story focuses on fixing the component-level errors that prevent those connections from working.

### Data Models
**Walk Schema Field Alignment** [Source: architecture.md#identified-constraints]
- Database schema uses `walk.averageRating` field name
- UI components incorrectly reference `walk.rating` causing undefined data
- Field reference mismatch must be corrected throughout codebase to display rating data properly

**Geographic Data Integration** [Source: architecture.md#compatibility-requirements]
- Mapbox integration and existing geographic data must continue functioning without interruption
- ScotlandRegionMap component is functional and ready for use
- RegionMap import error prevents walk discovery map from displaying

### API Specifications
**Convex Query Patterns** [Source: architecture.md#component-architecture]
- WalkDetailPage expects: `useQuery(api.walks.getById, { id: walkId })`
- Replace mock data with established query patterns from Story 1.1 implementation
- Maintain existing error handling and loading states for database connections

### Component Specifications
**WalkDiscovery Component** [Source: architecture.md#component-architecture]
- **File Location:** `app/walks/WalkDiscovery.tsx`
- **Import Error:** Line 13 references non-existent `RegionMap` component
- **Correct Import:** `ScotlandRegionMap` from `components/map/ScotlandRegionMap.tsx`
- **Integration Points:** Uses `useQuery(api.walks.getPublishedWalks)` and `useQuery(api.regions.getAllRegions)`

**WalkDetailPage Component** [Source: architecture.md#component-architecture]
- **File Location:** `app/walks/[slug]/WalkDetailPage.tsx`
- **Current State:** Uses mock data instead of live Convex queries
- **Required Integration:** Connect to real database using functions from Story 1.1
- **Dependencies:** WalkMap component, existing UI components

### File Locations
**Component Files** [Source: architecture.md#source-tree-integration]
- `app/walks/WalkDiscovery.tsx` - Fix import on line 13
- `app/walks/[slug]/WalkDetailPage.tsx` - Remove mock data, add Convex queries
- `components/map/ScotlandRegionMap.tsx` - Existing working component to import
- Search pattern: `**/*.tsx` for all `walk.rating` references to update

**Project Structure Alignment** [Source: architecture.md#source-tree-integration]
- Maintain Next.js App Router structure and component categorization
- Follow existing kebab-case for files, PascalCase for components
- Use absolute imports with @/ prefix pattern

### Testing Requirements
**Integration Testing** [Source: architecture.md#testing-strategy]
- **WalkDiscovery Component:** Test `ScotlandRegionMap` import resolution and data fetching
- **WalkDetailPage Component:** Validate connections to real database queries work correctly
- **Framework:** Continue existing Next.js testing framework patterns
- **Coverage Target:** Maintain existing coverage levels for modified components

**User Acceptance Testing** [Source: architecture.md#testing-strategy]
- Verify walk browsing functionality continues working for existing users
- Confirm map components display properly with existing geographic data
- Test that database field changes don't break existing walk records or user interactions

### Technical Constraints
**Existing System Compatibility** [Source: architecture.md#enhancement-scope-and-integration-strategy]
- Integration Impact: Low-risk surgical changes - no architectural restructuring required
- Performance Impact: Neutral to positive - removing mock data reduces rendering overhead
- API Compatibility: 100% maintained - no Convex function signatures change

**Component Architecture Preservation** [Source: architecture.md#component-architecture]
- Maintain existing component patterns and TailwindCSS styling
- Preserve existing loading states and error handling patterns
- Follow established React 19 functional components with hooks approach

**Security Rules** [Source: architecture.md#security-integration]
- Verify field reference changes don't expose unauthorized data
- Maintain existing authentication context and user access patterns
- Preserve component security boundaries during import fixes

### Testing
**Testing Standards** [Source: architecture.md#testing-strategy]
- **Location:** Follow established test file organization alongside component files
- **Test Standards:** Component-level testing following Next.js conventions in project structure
- **Testing Framework:** Next.js testing environment with TypeScript support
- **Patterns:** Existing component render testing and prop validation patterns
- **Specific Requirements:** 
  - Test all affected pages render without console errors (AC: 5)
  - Verify all component imports resolve correctly (AC: 4)
  - Confirm real-time data updates work correctly after mock data removal

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-08-27 | v1.0 | Created story for fixing critical component import and field reference errors | Bob (Scrum Master) |

## Dev Agent Record

*(This section will be populated by the development agent during implementation)*

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results

*(This section will be populated by the QA Agent after story completion)*